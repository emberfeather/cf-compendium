<?xml version="1.0"?>
<project name="cf-compendium" default="prepare" basedir=".">
	<!-- Load ANT tasks -->
	<taskdef name="statsvn" classname="net.sf.statsvn.ant.StatSvnTask" classpath="${basedir}/dist/lib/statsvn.jar" />
	<taskdef name="mxunittask" classname="org.mxunit.ant.MXUnitAntTask" classpath="${basedir}/mxunit/ant/lib/mxunit-ant-java5.jar" />
	
	<!-- Include the property files -->
	<property file="${basedir}/common.properties"/>
	<property file="${basedir}/user.properties"/>
	
	<target name="prepare" description="Prepare environment for build">
		<!-- Define log file -->
		<record name="${basedir}${build.dist}/logs/${build.logfile}"/>
		
		<!-- Create the time stamp -->
		<tstamp>
			<format property="build.date" pattern="MM/dd/yy hh:mmaa"/>
		</tstamp>
		
		<echo message="${project.fullname} preparations complete"/>
	</target>
	
	<target name="logSVN" description="Generates logs from the repository">
		<exec executable="svn" output="${basedir}${build.dist}/logs/${svn.commit.log}">
			<arg value="log"/>
			<arg value="-v"/>
			<arg value="--xml"/>
			<arg value="${basedir}"/>
		</exec>
		
		<echo message="${project.fullname} svn log created at: ${basedir}${build.dist}/logs/${svn.commit.log}"/>
	</target>
	
	<target name="statSVN" description="Generates statistics from the repository">
		<statsvn
			path="${basedir}"
			log="${basedir}${build.dist}/logs/${svn.commit.log}"
			outputDir="${basedir}${build.dist}/stats"
			title="${project.fullname}"
			include="**/*.cfc;**/*.cfm;**/*.js;**/*.css;**/*.xml;**/*.properties"/>
		
		<echo message="${project.fullname} stats created at: ${basedir}${build.dist}/stats"/>
	</target>
	
	<target name="test" depends="prepare" description="Runs the Unit Tests">
		<mxunittask server="${mxunit.host}" port="${mxunit.port}" outputdir="${basedir}${build.dist}/unit" defaultrunner="${mxunit.defaultrunner}" verbose="${general.verbose}" haltonerror="true">
			<directory path="${basedir}/test" componentPath="${mxunit.componentpath}" recurse="true" />
		</mxunittask>
		
		<echo message="${project.fullname} tests have successfully run"/>
	</target>
</project>